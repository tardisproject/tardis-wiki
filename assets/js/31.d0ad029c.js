(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{404:function(e,t,s){"use strict";s.r(t);var a=s(46),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"mysql"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql"}},[e._v("#")]),e._v(" Mysql")]),e._v(" "),s("h3",{attrs:{id:"adding-service-accounts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#adding-service-accounts"}},[e._v("#")]),e._v(" Adding service accounts")]),e._v(" "),s("p",[s("code",[e._v("create database service_table_name;")]),e._v(" "),s("code",[e._v("GRANT ALL PRIVILEGES ON service_table_name.* to username@'%' IDENTIFIED BY 'password';")]),e._v(" "),s("code",[e._v("GRANT ALL PRIVILEGES ON service_table_name.* to username@localhost IDENTIFIED BY 'password';")])]),e._v(" "),s("h3",{attrs:{id:"adding-databases-users"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#adding-databases-users"}},[e._v("#")]),e._v(" Adding databases/users")]),e._v(" "),s("p",[e._v("While logged in to "),s("a",{attrs:{href:"sil",title:"wikilink"}},[e._v("sil")]),e._v(":")]),e._v(" "),s("p",[s("code",[e._v("mysql -u root -p")])]),e._v(" "),s("p",[e._v("Then:")]),e._v(" "),s("p",[s("code",[e._v("mysql> CREATE DATABASE")]),s("user",[s("code",[e._v(";")]),e._v(" "),s("code",[e._v("mysql> GRANT ALL PRIVILEGES ON")]),s("user",[s("code",[e._v(".* TO '")]),s("user",[s("code",[e._v("'@'%.tardis.ed.ac.uk' IDENTIFIED BY '")]),s("password",[s("code",[e._v("';")])])],1)],1)],1)],1),e._v(" "),s("p",[e._v("If you need to connect to this database from davros (which has old php\npackages) you need to convert the password to an old-style version with")]),e._v(" "),s("p",[s("code",[e._v("SET PASSWORD FOR 'some_user'@'some_host' = OLD_PASSWORD('newpwd');")])]),e._v(" "),s("p",[e._v("I hope these passwords still work when we move over to mara.")]),e._v(" "),s("p",[s("em",[e._v("Also, there's probably a way to compound those lines, but I CBA testing\nit. wv.")])]),e._v(" "),s("p",[e._v("See: "),s("a",{attrs:{href:"http://dev.mysql.com/doc/refman/5.0/en/old-client.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("1"),s("OutboundLink")],1),e._v(" for\nmore information.")]),e._v(" "),s("h2",{attrs:{id:"postgresql"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#postgresql"}},[e._v("#")]),e._v(" PostgreSQL")]),e._v(" "),s("p",[s("em",[e._v("Note, this was copied straight from the original doc, and is a bit out\nof date (RIP troughton). Also, it's not an appropriate way to do\nbackups. "),s("a",{attrs:{href:"User:Seth",title:"wikilink"}},[e._v("Seth")])])]),e._v(" "),s("p",[e._v("As of 2004-04-18 a PostgreSQL database service is available for user\naccess. The server is running on peri, and client access has been\nconfigured on mccoy.")]),e._v(" "),s("p",[e._v("This service is being maintained by Martin Ling (mling@tardis). The\nPostgreSQL version currently deployed is 7.4.5.")]),e._v(" "),s("h3",{attrs:{id:"administrator-notes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#administrator-notes"}},[e._v("#")]),e._v(" Administrator notes")]),e._v(" "),s("h4",{attrs:{id:"adding-accounts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#adding-accounts"}},[e._v("#")]),e._v(" Adding accounts")]),e._v(" "),s("p",[e._v("To create a new PostgreSQL user account, execute as root on troughton:\n"),s("em",[e._v("(peri??)")])]),e._v(" "),s("p",[s("code",[e._v("su - postgres -c 'createuser --createdb --no-adduser -P'")])]),e._v(" "),s("p",[e._v("and enter the username and a password as required. The username should\nmatch the requesting user's TARDIS account name.")]),e._v(" "),s("p",[e._v("Note that these options allow the user to create and remove their own\ndatabases as they require, and grant or revoke permissions on them to\nother PostgreSQL users. Users should be advised not to use generic names\nsuch as 'test' for their databases, as the names must be globally unique\nwithin the server.")]),e._v(" "),s("h4",{attrs:{id:"configuring-client-hosts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuring-client-hosts"}},[e._v("#")]),e._v(" Configuring client hosts")]),e._v(" "),s("p",[e._v("Hosts from which users will use the PostgreSQL client should have the\n"),s("code",[e._v("postgresql-client")]),e._v(" package installed, with version matching that of the\nserver install. The file /etc/postgresql/postgresql.env should be edited\nand PGHOST set to the current database server, and /etc/profile should\nsource this file.")]),e._v(" "),s("h4",{attrs:{id:"moving-or-restoring-the-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#moving-or-restoring-the-service"}},[e._v("#")]),e._v(" Moving or restoring the service")]),e._v(" "),s("p",[e._v("Should the databases need to be restored from a backup, or the service\nmoved to a different server, the new or restored server must be set up\nwith a fresh installation of "),s("code",[e._v("postgresql")]),e._v(" package, with the same version\nas used previously.")]),e._v(" "),s("p",[e._v("After installation the server should be stopped, and the\n/var/lib/postgres/data directory replaced with that from the old server\nor backup (/var/autofs/backups/postgres/data). Note that permission\ninformation must be maintained. The access control configuration\n/etc/postgresql/pg_hba.conf should also be transferred or set to contain\nthe line:")]),e._v(" "),s("p",[s("code",[e._v("host         all         193.62.81.0   255.255.255.0       md5")])]),e._v(" "),s("p",[e._v("in place of:")]),e._v(" "),s("p",[s("code",[e._v("host         all         0.0.0.0       0.0.0.0             reject")])]),e._v(" "),s("p",[e._v("which is installed by default.")]),e._v(" "),s("p",[e._v("The server can then be restarted.")]),e._v(" "),s("p",[e._v("Finally, a cron job should be configured to execute nightly as root on\nthe server:")]),e._v(" "),s("p",[e._v("cp -a /var/lib/postgres/data /var/autofs/backups/postgres")]),e._v(" "),s("h4",{attrs:{id:"upgrading-the-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#upgrading-the-service"}},[e._v("#")]),e._v(" Upgrading the service")]),e._v(" "),s("p",[e._v("When the service is running normally an upgrade can be performed simply\nby installing the newer "),s("code",[e._v("postgresql")]),e._v(" package on the server, and\nupgrading clients to match. The Debian postinst scripts handle the\nprocess of carrying databases safely through an upgrade.")]),e._v(" "),s("p",[e._v("However, please contact the maintainer before attempting this.")]),e._v(" "),s("p",[s("a",{attrs:{href:"Category:Services",title:"wikilink"}},[e._v("Category:Services")])])])}),[],!1,null,null,null);t.default=r.exports}}]);