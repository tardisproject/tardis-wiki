(window.webpackJsonp=window.webpackJsonp||[]).push([[162],{533:function(e,t,a){"use strict";a.r(t);var n=a(46),o=Object(n.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("p",[a("em",[e._v("Work in progress. -- Thom 17/12/09")])]),e._v(" "),a("h2",{attrs:{id:"overview"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),a("ul",[a("li",[e._v("We currently have two Xen hosts: "),a("a",{attrs:{href:"WOTAN",title:"wikilink"}},[e._v("WOTAN")]),e._v(" and\n"),a("a",{attrs:{href:"Oracle",title:"wikilink"}},[e._v("Oracle")]),e._v(".")])]),e._v(" "),a("h2",{attrs:{id:"creating-new-xen-instances"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#creating-new-xen-instances"}},[e._v("#")]),e._v(" Creating new Xen instances")]),e._v(" "),a("h4",{attrs:{id:"naming-your-host"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#naming-your-host"}},[e._v("#")]),e._v(" Naming your host")]),e._v(" "),a("ul",[a("li",[e._v("Think of a name. We like Dr Who themed names! If you recycle a name\nyou'll probably upset Thom -- why not ask Malcolm for advice?")]),e._v(" "),a("li",[e._v("At this point you should also create a wiki page explaining your\nVM's purpose and config. Use one of the other Xen machines' pages as\na starting point.")]),e._v(" "),a("li",[e._v("Find a free IP and add forward and reverse mappings to the\n"),a("a",{attrs:{href:"DNS_Service",title:"wikilink"}},[e._v("DNS")]),e._v(".")])]),e._v(" "),a("h4",{attrs:{id:"find-a-xen-host"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#find-a-xen-host"}},[e._v("#")]),e._v(" Find a Xen host")]),e._v(" "),a("ul",[a("li",[e._v("Our main constraints on Xen hosts are RAM and disk space.")]),e._v(" "),a("li",[e._v("Use "),a("code",[e._v("vgs")]),e._v(" to show free disk space in the volume group")]),e._v(" "),a("li",[e._v("Check amount of RAM allocated to dom0 in "),a("code",[e._v("xentop")]),e._v(" for a poor\nestimation of potentially free RAM.")])]),e._v(" "),a("h4",{attrs:{id:"create-disk-volumes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-disk-volumes"}},[e._v("#")]),e._v(" Create disk volumes")]),e._v(" "),a("ul",[a("li",[e._v("Create root volume:\n"),a("code",[e._v("lvcreate -L 4GB -n")]),a("hostname",[a("code",[e._v("-root")]),a("volume-group",[a("ul",[a("li",[e._v("2GB is just about enough for a Debian install.")]),e._v(" "),a("li",[e._v("You can find out the volume group name with "),a("code",[e._v("vgs")])])])])],1)],1),e._v(" "),a("li",[e._v("Create swap volume:\n"),a("code",[e._v("lvcreate -L 256MB -n")]),a("hostname",[a("code",[e._v("-swap")]),a("volume-group",[a("ul",[a("li",[e._v("Use your favourite rule of thumb for guessing a completely\narbitrary quantity of swap space to allocate. If your machine\nstarts thrashing you'll probably upset someone, so it's better\noff being small.")])])])],1)],1)]),e._v(" "),a("h4",{attrs:{id:"create-xen-configuration-file"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-xen-configuration-file"}},[e._v("#")]),e._v(" Create Xen configuration file")]),e._v(" "),a("p",[e._v("Combine the following config, as customized to your specifications, with\nthe Debian xen installer config file\n"),a("a",{attrs:{href:"http://ftp.debian.org/debian/dists/lenny/main/installer-i386/current/images/netboot/xen/xm-debian.cfg",target:"_blank",rel:"noopener noreferrer"}},[e._v("1"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("p",[e._v("Put the new config file in "),a("code",[e._v("/etc/xen/")]),a("hostname",[a("code",[e._v(".conf")])])],1),e._v(" "),a("p",[a("em",[e._v("Note. The IP bit is possibly redundant. Replace with blank string?")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("memory = <amount of memory in MB>\nname = \"<host-name>\"\nvif = ['ip=<ip>']\ndisk = [ 'phy:/dev/<volume-group>/<host-name>-root,xvda,w',\n         'phy:/dev/<volume-group>/<host-name>-swap,xvdb,w' ]\n\n#============================================================================\n# Debian Installer specific variables\n<<<INSERT REST OF DEBIAN XEN CONFIG FILE HERE>>>\n")])])]),a("h4",{attrs:{id:"install-debian"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#install-debian"}},[e._v("#")]),e._v(" Install Debian")]),e._v(" "),a("ul",[a("li",[e._v("There's probably a way to get the installer to load via an HTTP\nproxy, but I'm lazy so I just punch a temporary hole in the\nfirewall:\n"),a("ul",[a("li",[a("code",[e._v("ace:~# iptables -I FORWARD -s oracle -d ftp.uk.debian.org -j ACCEPT")])])])]),e._v(" "),a("li",[e._v("Start the installer\n"),a("ul",[a("li",[a("code",[e._v("xm create -c ukairo.conf install=true install-mirror=")]),a("a",{attrs:{href:"ftp://ftp.uk.debian.org/debian"}},[a("code",[e._v("ftp://ftp.uk.debian.org/debian")])])])])])]),e._v(" "),a("ul",[a("li",[e._v("Exciting installer notes!\n"),a("ul",[a("li",[e._v("DHCP got an address the first time round. It probably shouldn't\nhave. Configure manually if you get the chance.\n"),a("ul",[a("li",[e._v("Gateway is "),a("code",[e._v(".1")]),e._v(", DNS is "),a("code",[e._v(".14")]),e._v(".")])])]),e._v(" "),a("li",[e._v("Configure the proxy as\n"),a("a",{attrs:{href:"http://free.cache.ed.ac.uk:3128",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("http://free.cache.ed.ac.uk:3128")]),a("OutboundLink")],1)]),e._v(" "),a("li",[e._v("Partition manually. The installer gets confused otherwise")]),e._v(" "),a("li",[e._v('Be careful not to select "Desktop" in tasksel!\n'),a("ul",[a("li",[e._v("Also this doesn't pull in openssh-server, and makes things\ndepend on X. This is bad. FIXME")])])]),e._v(" "),a("li",[e._v("Bootloader... WTF. FIXME.")])])])]),e._v(" "),a("ul",[a("li",[e._v("Unbreak the firewall.\n"),a("ul",[a("li",[a("code",[e._v("ace:~# iptables -D FORWARD -s oracle -d ftp.uk.debian.org -j ACCEPT")])])])])]),e._v(" "),a("h4",{attrs:{id:"booting-your-instance"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#booting-your-instance"}},[e._v("#")]),e._v(" Booting your instance")]),e._v(" "),a("ul",[a("li",[e._v("Remove the Debian installer cruft from the config file.")]),e._v(" "),a("li",[e._v("Add kernel=, initrd=, and root= entries\n"),a("ul",[a("li",[e._v("There's probably a better way to do this, as this means we're\nmissing modules... FIXME")])])]),e._v(" "),a("li",[a("code",[e._v("xm create -c")]),a("newmachinename",[a("code",[e._v(".conf>")]),e._v(" "),a("ul",[a("li",[e._v("Will boot instance and attach to console. Check you can log in.")]),e._v(" "),a("li",[e._v("Use ctrl+] to get back to the Xen host console.")])])])],1)]),e._v(" "),a("h4",{attrs:{id:"finishing-up"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#finishing-up"}},[e._v("#")]),e._v(" Finishing up")]),e._v(" "),a("ul",[a("li",[e._v("Congratulations, you now have a new Xen domU!")])]),e._v(" "),a("h2",{attrs:{id:"booting-and-shutting-down"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#booting-and-shutting-down"}},[e._v("#")]),e._v(" Booting and Shutting Down")]),e._v(" "),a("p",[e._v("Xen's init scripts are set up to perform an `xm save` (copy the RAM to\ndisk) for each domU that's running when vislor and/or adric are shut\ndown and to restore saved domUs on boot. This should take care of the\ncases where tardis is shut down intentionally, but a bit more work will\nhave to be done following an unexpected power loss. (When do they happen\nanyway? ðŸ˜‰")]),e._v(" "),a("p",[e._v("To start all domUs on vislor do:")]),e._v(" "),a("p",[a("code",[e._v("forÂ fooÂ inÂ /etc/xen/*.conf;Â doÂ xmÂ createÂ -cÂ $foo;Â done")]),e._v(" "),a("WAIT",{attrs:{FOR:"",A:"",LOGIN:"",PROMPT:""}},[a("code",[e._v("ctrl+]")]),e._v(" "),a("WAIT",{attrs:{FOR:"",A:"",LOGIN:"",PROMPT:""}},[a("code",[e._v("ctrl+]")]),e._v(" "),a("code",[e._v("....")])])],1)],1),e._v(" "),a("p",[a("a",{attrs:{href:"category:Services",title:"wikilink"}},[e._v("category:Services")]),e._v(" "),a("a",{attrs:{href:"category:Infrastructure",title:"wikilink"}},[e._v("category:Infrastructure")])]),e._v(" "),a("p",[a("a",{attrs:{href:"Category:OutOfDate",title:"wikilink"}},[e._v("Category:OutOfDate")])])])}),[],!1,null,null,null);t.default=o.exports}}]);