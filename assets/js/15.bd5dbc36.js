(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{388:function(e,t,s){"use strict";s.r(t);var a=s(46),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("p",[e._v("The other half of the raid array for the homedirs in\n"),s("a",{attrs:{href:"dalek",title:"wikilink"}},[e._v("dalek")]),e._v(" is sitting in\n"),s("a",{attrs:{href:"brigadier",title:"wikilink"}},[e._v("brigadier")]),e._v(". We do not have any form of backups of\nhomedirs in place, other than a copy from about a year ago.")]),e._v(" "),s("p",[e._v("Same applies to the "),s("a",{attrs:{href:"davros",title:"wikilink"}},[e._v("webserver")]),e._v(", although it's raid\nis in place, the disk has some very bizarre filesystem errors (re:\n~kate/qcmweb)")]),e._v(" "),s("h2",{attrs:{id:"things-to-backup"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#things-to-backup"}},[e._v("#")]),e._v(" Things to backup")]),e._v(" "),s("h3",{attrs:{id:"user-data"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#user-data"}},[e._v("#")]),e._v(" User data")]),e._v(" "),s("p",[s("em",[e._v("This is stuff we just can't get back/rebuild")])]),e._v(" "),s("p",[s("a",{attrs:{href:"LDAP",title:"wikilink"}},[e._v("LDAP")]),e._v("\nCurrently backed up using '/root/ldap/backup', run from cron on\n"),s("a",{attrs:{href:"Piper",title:"wikilink"}},[e._v("Piper")]),e._v(" (the "),s("a",{attrs:{href:"LDAP",title:"wikilink"}},[e._v("LDAP")]),e._v(" server). The\nscript saves backups to '/export/home/backups/ldap/' and these should be\ncopied elsewhere, for obvious reasons.")]),e._v(" "),s("p",[e._v("Home dirs\nRAIDed again but no regular backups as yet.")]),e._v(" "),s("p",[e._v("Mail dirs\n"),s("em",[e._v("Similarly")])]),e._v(" "),s("p",[e._v("Web dirs\nRaid-Mirrored. Not backed-up.")]),e._v(" "),s("p",[e._v("Databases\nNot backed up. We should probably do SQL dumps, rather than dumps of the\nraw db backened.")]),e._v(" "),s("p",[s("a",{attrs:{href:"Lists_Service",title:"wikilink"}},[e._v("Lists Service")]),e._v("\nNot backed up. No idea how it needs to be done.")]),e._v(" "),s("h3",{attrs:{id:"other-stuff"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#other-stuff"}},[e._v("#")]),e._v(" Other stuff")]),e._v(" "),s("p",[e._v("System configurations\n"),s("a",{attrs:{href:"LCFG",title:"wikilink"}},[e._v("LCFG")]),e._v(" proved too much of a beast to handle. Best\nmethods for doing this, suggestions?")]),e._v(" "),s("p",[e._v("Backing up "),s("code",[e._v("/etc")]),e._v(" would "),s("em",[e._v("help")]),e._v(" in a lot of cases, but isn't a proper\nsolution.")]),e._v(" "),s("p",[e._v("System logs\nThere's probably some sense in this, if we get haX0rised, but that's\nprobably OTT.")]),e._v(" "),s("p",[e._v("Logs are kept on each system and sent to "),s("a",{attrs:{href:"Piper",title:"wikilink"}},[e._v("Piper")]),e._v(" (see\n"),s("a",{attrs:{href:"Log_Host",title:"wikilink"}},[e._v("Log_Host")]),e._v(") so this should be enough.")]),e._v(" "),s("p",[e._v("The wiki\nThis could/should be covered by our regular (cough) database backups.")]),e._v(" "),s("p",[e._v("DNS data\nThis could be covered by the 'System configurations' bit above or be\ndone by taking backups of '"),s("a",{attrs:{href:"leela",title:"wikilink"}},[e._v("leela")]),e._v(":/etc/bind/'\nspecifically.")]),e._v(" "),s("p",[s("a",{attrs:{href:"Xen",title:"wikilink"}},[e._v("Xen")]),e._v("\nIt might be good to take some LVM snapshots of the root FSes of our Xen\nVMs. It's not a real backup but would be a quick way to recover from any\nproblems on the VMs.")]),e._v(" "),s("p",[e._v("The "),s("a",{attrs:{href:"firewall",title:"wikilink"}},[e._v("firewall")]),e._v("\nWe could do with some backups of the firewall script.")]),e._v(" "),s("h2",{attrs:{id:"solution"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#solution"}},[e._v("#")]),e._v(" Solution")]),e._v(" "),s("p",[s("a",{attrs:{href:"User:Pert",title:"wikilink"}},[e._v("Pert")]),e._v(" had started installing a new machine which\ncontained one 120GB disk in LVM.")]),e._v(" "),s("p",[e._v("This was going to run BackupPC but this does not allow users to restore\nthier own files and does not seem to play well with rsync. Therefore\nI've been testing a new solution, using rsync to create hard-link-based\nincremental backups. The script I've been writing is currently in /root/\non piper and so far this has only been tested on the home directories.")]),e._v(" "),s("h3",{attrs:{id:"architecture"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#architecture"}},[e._v("#")]),e._v(" Architecture")]),e._v(" "),s("p",[e._v("Backups will be pushed from the various servers (file, web, etc.) to\nbackup.t using rsync, some scripts and cron. Rsync's '--link-dest'\nargument will be used to create hard-link-based incremental backups on\nthe LVMed space in backup.t.")]),e._v(" "),s("p",[e._v("As it would be tricky to monitor the backups on each of the servers\nusing the backup service, (file, web, etc.) monitoring will be done by a\nscript on backup.t. It should mail daily reports to a specific person\n(WV me (pert)) who will notice and fix things if the mails stop. These\nmails should contain disk usage info from backup.t and warn about missed\nbackups. This script will probably also be responsible for removing\nbackups as they get old.")]),e._v(" "),s("p",[e._v("Backups of home directories and mail will be shared out to the shell\nserver(s) using NFS so users can restore their own files.")]),e._v(" "),s("p",[e._v("Here's an example of the directory structure used on backup.t:")]),e._v(" "),s("code",[s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("/export/\n/export/home\n/export/home/2006-02-23\n/export/home/2006-02-23/newusers\n...\n/export/home/2006-02-24\n/export/home/2006-02-24/newusers\n...\n/export/mail/2006-02-23\n/export/mail/2006-02-23/pert\n...\n/export/mysql\n...\n/export/psql\n...\n...\n")])])])]),e._v(" "),s("p",[s("a",{attrs:{href:"Category:OutOfDate",title:"wikilink"}},[e._v("Category:OutOfDate")])])])}),[],!1,null,null,null);t.default=r.exports}}]);